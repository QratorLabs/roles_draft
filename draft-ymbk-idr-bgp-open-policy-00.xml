<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC4271 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4271.xml">
<!ENTITY RFC4486 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4486.xml">
<!ENTITY RFC5226 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5226.xml">
<!ENTITY RFC5492 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5492.xml">
<!ENTITY I-D.ietf-grow-route-leak-problem-definition SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-grow-route-leak-problem-definition-03.xml">
<!ENTITY I-D.ietf-idr-route-leak-detection-mitigation SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-idr-route-leak-detection-mitigation-01.xml">
]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<rfc category="std" docName="draft-ymbk-idr-bgp-open-policy-00" ipr="trust200902">
 <front>

   <title abbrev="Route Leak Detection and Filtering"> Route Leak Detection and Filtering using Roles in Update and Open messages </title>

   <author fullname="Alexander Azimov" initials="A"
           surname="Azimov">
     <organization>Qrator Labs</organization>
     <address>
       <email>aa@qrator.net</email>
     </address>
   </author>

   <author fullname="Eugene Bogomazov" initials="E"
           surname="Bogomazov">
     <organization>Qrator Labs</organization>
     <address>
       <email>eb@qrator.net</email>
     </address>
   </author>

   <author fullname="Randy Bush" initials="R"
           surname="Bush">
     <organization>Internet Initiative Japan</organization>
     <address>
       <email>randy@psg.com</email>
     </address>
   </author>

   <date year="2016"/>
   <area>Routing</area>

   <keyword>Route leak</keyword>
   <keyword>BGP role</keyword>

   <abstract>
     <t>
       Route Leaks are propagation of BGP prefixes which violate assumptions
       of BGP topology relationships; e.g. passing a route learned from one
       peer to another peer or a transit provider, passing a route learned
       from one transit provider to another transit provider or to a peer.
       Today, approaches to leak prevention rely on marking routes
       according to some configuration options without any check of this
       configuration or enforcement that the two BGP speakers agree on the
       relationship.   This document enhances BGP Open to establish agreement
       of the (peer, customer, provider, internal) relationship of the two BGP speakers
       to enforce appropriate configuration on both sides. Propagated routes
       are then marked with that relationship, and if the markings
       are propagated, allowing detection of route leaks.
     </t>
   </abstract>

   <note title="Requirements Language">
     <t>
       The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
       "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" are to be
       interpreted as described in <xref target="RFC2119">RFC 2119</xref>
       only when they appear in all upper case.  They may also appear in lower
       or mixed case as English words, without normative meaning.
     </t>
   </note>
 </front>

 <middle>
   <section title="Introduction" anchor="intro">
     <t>
       For the purposes of this document BGP route leaks are when BGP route
       was learned from transit provider or peer and is announced to another
       provider or peer.  See <xref target="I-D.ietf-grow-route-leak-problem-definition"/>.
       These are usually the result of misconfigured or absent BGP route filtering or
       lack of coordination between two BGP speakers.
     </t>

     <t>
       <xref target="I-D.ietf-idr-route-leak-detection-mitigation"/> describes a method of
       marking and detecting leaks which relies on white listing prefixes from customer cone.
       Unfortunately, majority of incidents are created by leaking routes from customer cone.
       Automatic route tagging, which is planned as part of BGPSec deployment, relies on operator maintained
       markings configuration option and will likely also be misconfigured.
     </t>

     <t>
       This document specifies a new BGP Capability Code (see
       <xref target="RFC5492"> RFC 5492 </xref> section 4) through which the two BGP
       speakers MAY use to ensure that they MUST agree on their relationship; i.e. customer and provider or
       peers.  Either side or both may optionally be configured to require that this
       option be exchanged for the BGP Open to succeed.
     </t>

     <t>
       Also this document specifies a way to mark routes according to roles and a way
       to create double-boundary filters for detection and preventing propagation of route leaks via new
       BGP Path Attribute.
     </t>
   </section>

   <section anchor="bgp_role" title="BGP Role">
     <t>BGP Role is new mandatory configuration option. It reflects the
     verbal real-world agreement between two BGP speakers about their
     business relationship.</t>

     <t>For now, possible Role values are: <list style="symbols">
         <t>Provider - speaker is a transit provider to neighbor;</t>
         <t>Customer - speaker is customer of neighbor;</t>
         <t>Peer     - speaker and neighbor are peers;</t>
         <t>Internal - speaker is part of an internal AS of an
         organization which has multiple ASs, confederation, ...</t>
       </list> </t>
     <t>Since BGP Role reflects the relationship between two BGP
     speakers, it can also be used for more than route leak
     mitigation.</t>
   </section>

   <section anchor="capability" title="Role capability">
     <t> The TLV (type, length, value) of the BGP Role capability
     are: <list style="symbols">
     <t> Type   - &lt;TBD1&gt;;</t>
     <t> Length - 1 (octet);</t>
     <t> Value - integer corresponding to speaker' BGP Role.</t>
     </list></t>
     <texttable anchor="values" title="Predefined BGP Role Values" suppress-title="false">
     <ttcol align="center"> Value </ttcol>
     <ttcol align="left"> Role name </ttcol>
     <c> 0   </c> <c> Undefined </c>
     <c> 1   </c> <c> Sender is Peer      </c>
     <c> 2   </c> <c> Sender is Provider  </c>
     <c> 3   </c> <c> Sender is Customer  </c>
     <c> 4   </c> <c> Sender is Internal  </c>
     </texttable>

     </section>

   <section anchor="correctness" title="Role correctness">
     <t><xref target="bgp_role"/> described how BGP Role is a reflection
     of the relationship between two BGP speakers. But the presence of
     BGP Role doesn't automatically guarantee role correctness.</t>

     <t>To enforce correctness using the BGP Role check, there is a set
     of constrains on how speakers' BGP Roles MUST corresponded.  Of
     course, each speaker MUST announce and accept the BGP Role
     capability in the BGP OPEN message exchange.</t>

     <t> If a speaker receives a BGP Role capability, it SHOULD check
     value of received capability with its own BGP Role. The allowed
     pairings are (first is its own Role, second is received
     Role): <list style="symbols">
     <t> (Peer, Peer);  </t>
     <t> (Provider, Customer); </t>
     <t> (Customer, Provider); </t>
     <t> (Internal, Internal); </t>
     </list> In all other cases speaker MUST send a Role Mismatch
     Notification (code 2, sub-code &lt;TBD2&gt;).</t>

     <section title="Strict mode" anchor="strict">
     <t>A new BGP configuration option "strict mode" is defined with
     values of true or false. If set to true, then the speaker MUST
     reject connection with peers which do not announce BGP Role
     capability in their OPEN message. If a speaker rejects a
     connection, it MUST send a Connection Rejected Notification
     <xref target="RFC4486"/> (Notification with error code 6, subcode
     5).  But by default strict mode SHOULD be set with false for
     backward compatibility with BGP speakers, that do not yet support
     this mechanism.</t>
    </section>
   </section>

   <section anchor="attribute" title="BGP Announce Vector Marker attribute">
     <t>
       The Announce Vector Marker (AVM) attribute is a new optional, transitive BGP Path
       attribute with the Type Code &lt;TBD3&gt;. This attribute has zero length as
       it used as a flag.
     </t>
     
     <section anchor="usage" title="Attribute usage">
       <t> There are four rules for usage of AVM attribute:
         <list style="numbers">
           <t>
             The AVM attribute SHOULD be added to all incoming routes if speaker's
             Role is Provider or Peer;
           </t>
           <t>
             Routes with set AVM attribute SHOULD NOT be announced if speaker's Role is
             Provider or Peer;
           </t>
           <t>
             The AVM attribute SHOULD be added to all outgoing routes if speaker
             hasn't sent role capability in Open message and speaker's Role is Customer or Peer;
           </t>
           <t>
             If speaker's Role is Customer or Peer, all incoming routes with the set AVM
             attribute SHOULD have low Local Preference Attribute or MAY be filtered.
           </t>
         </list>
         First two rules avoid creation of route leak inside given AS.
         Last two rules provide detection of route leak made by some AS in AS Path.
       </t>
       <t>
         So, the AVM attribute will be added, if at least one of speakers
         correctly set its role. In addition, the AVM attribute
         will be checked, if also at least one of speakers set its role correct. In other
         words, such logic offers double-checking on borders to prevent route leaks.
       </t>
     </section>
   </section>
   
   <section anchor="considerations" title="Additional Considerations">
     <t>
       Role can be used not only for route leak mitigation. As it reflects the relationship
       between speakers, it can be used further to solve another tasks. As an example,
       role may affect on route priority.
     </t>
     <t>
       Although such a solution may be good, its proposal is not the task of this document.
       Meanwhile, decision for such a usage may be accept only with local policy approval.
     </t>
   </section>


   <section anchor="IANA" title="IANA Considerations">
     <t>This document defines a new Capability Codes option, named "BGP
     Role", assigned value &lt;TBD1&gt; [to be removed upon publication:
     http://www.iana.org/assignments/capability-codes/capability-codes.xhtml]
     <xref target="RFC5492"/>. The length of this capability is 1. </t>

     <t>The BGP Role capability includes a Value field, for which IANA
     is asked to create and maintain a new sub-registry called "BGP Role
     Value". Initial values of this registry are to be populated with
     the Values in <xref target="values"/>. Future assignments are to be
     made upon Standard action procedure <xref target="RFC5226"/>.
     Assignments consist of Value and corresponding Role name.</t>
     <t>
       Also this document defines new Notification option, named "Role Mismatch", assigned
       value &lt;TBD2&gt; from OPEN message Error subcodes [to be removed upon publication:
       http://www.iana.org/assignments/bgp-parameters/bgp-parameters.xhtml#bgp-parameters-6]
     <xref target="RFC4271"/>.</t>
	 
	 <t>
       Finally, this memo defines a new optional, non-transitive BGP Path Attributes option,
       named "Announce Vector Marker", assigned value &lt;TBD3&gt; [To be removed upon
       publication:
       http://www.iana.org/assignments/bgp-parameters/bgp-parameters.xhtml#bgp-parameters-2]
       <xref target="RFC4271"/>. Length of this attribute is 0.
     </t>
   </section>

   <section anchor="Security" title="Security Considerations">
     <t>
       This document proposes a mechanism for avoiding route leaks, that are
       result of misconfiguration. That includes preventing route leaks creation inside AS (company)
       and route leak detection, if route was leaked by third party.
     </t>
     <t>
       Deliberate sending of a known conflicting BGP Role could be used to sabotage a BGP connection.
       This is easily detectable.
     </t>
     <t>
       However, detection of routes with malformed AVM attribute should
       be considered in future works.
     </t>

     <t> Finally, BGP Role is disclosed only to an immediate BGP speaker, so it
     will not itself reveal any sensitive information to third parties. </t>
   </section>
 </middle>

 <back>
   <references title="Normative References">
     &RFC2119;
     &RFC4271;
     &RFC4486;
     &RFC5492;
   </references>

   <references title="Informative References">
     &RFC5226;
     &I-D.ietf-grow-route-leak-problem-definition;
     &I-D.ietf-idr-route-leak-detection-mitigation;
  </references>
 </back>
</rfc>


