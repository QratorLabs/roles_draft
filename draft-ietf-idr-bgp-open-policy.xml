<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC4271 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4271.xml">
<!ENTITY RFC4486 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4486.xml">
<!ENTITY RFC8126 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8126.xml">
<!ENTITY RFC5492 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5492.xml">
<!ENTITY RFC7908 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7908.xml">
<!ENTITY RFC8174 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY RFC8212 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8212.xml">
<!ENTITY RFC8205 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8205.xml">

<!ENTITY I-D.ietf-grow-route-leak-detection-mitigation SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-grow-route-leak-detection-mitigation.xml">
<!ENTITY I-D.ietf-sidrops-aspa-verification SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-sidrops-aspa-verification.xml">
]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<rfc category="std" docName="draft-ietf-idr-bgp-open-policy-16" ipr="trust200902">
  <front>
    <title abbrev="Route Leak Prevention">Route Leak Prevention using Roles in UPDATE and OPEN messages</title>
    <author fullname="Alexander Azimov" initials="A." surname="Azimov">
      <organization>Qrator Labs &amp; Yandex</organization>
      <address>
        <postal>
          <street>Ulitsa Lva Tolstogo 16</street>
          <city>Moscow</city>
          <code>119021</code>
          <country>Russian Federation</country>
        </postal>
        <email>a.e.azimov@gmail.com</email>
      </address>
    </author>

    <author fullname="Eugene Bogomazov" initials="E." surname="Bogomazov">
      <organization>Qrator Labs</organization>
      <address>
        <postal>
          <street>1-y Magistralnyy tupik 5A</street>
          <city>Moscow</city>
          <code>123290</code>
          <country>Russian Federation</country>
        </postal>
        <email>eb@qrator.net</email>
      </address>
    </author>

    <author fullname="Randy Bush" initials="R." surname="Bush">
      <organization>Internet Initiative Japan &amp; Arrcus, Inc.</organization>
      <address>
        <postal>
          <street>5147 Crystal Springs</street>
          <city>Bainbridge Island</city>
          <region>Washington</region>
          <code>98110</code>
          <country>United States of America</country>
        </postal>
        <email>randy@psg.com</email>
      </address>
    </author>

    <author fullname="Keyur Patel" initials="K." surname="Patel">
      <organization>Arrcus</organization>
      <address>
        <postal>
          <street>2077 Gateway Place, Suite #400</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95119</code>
          <country>US</country>
          </postal>
        <email>keyur@arrcus.com</email>
      </address>
    </author>

    <author fullname="Kotikalapudi Sriram" initials="K." surname="Sriram">
      <organization abbrev="USA NIST">USA National Institute of Standards and Technology</organization>
      <address>
        <postal>
          <street>100 Bureau Drive</street>
          <city>Gaithersburg</city>
          <region>MD</region>
          <code>20899</code>
          <country>United States of America</country>
        </postal>
        <email>ksriram@nist.gov</email>
      </address>
    </author>


    <date/>

    <keyword>BGP</keyword>
    <keyword>Route leak</keyword>
    <keyword>BGP Role</keyword>

    <abstract>
      <t>
        Route leaks are the propagation of BGP prefixes which violate assumptions of BGP topology relationships; e.g. passing a route learned from one lateral peer to another lateral peer or a transit provider, passing a route learned from one transit provider to another transit provider or a lateral peer.
        Existing approaches to leak prevention rely on marking routes by operator configuration, with no check that the configuration corresponds to that of the eBGP neighbor, or enforcement that the two eBGP speakers agree on the relationship.
        This document enhances the BGP OPEN message to establish an agreement of the relationship between two eBGP speakers in order to enforce appropriate configuration on both sides.
        Propagated routes are then marked according to the agreed relationship, allowing both prevention and detection of route leaks.
      </t>
    </abstract>

    <note title="Requirements Language">
      <t>
	The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
	"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
	"OPTIONAL" in this  document are to be interpreted as described in
	BCP&nbsp;14 <xref target="RFC2119"/> <xref target="RFC8174"/> when,
	and only when, they appear in all capitals, as shown here.
      </t>
    </note>
  </front>

  <middle>

    <section title="Introduction" anchor="intro">
      <t>
        A BGP route leak occurs when a route is learned from a transit provider or lateral peer and then announced to another provider or lateral peer <xref target="RFC7908"/>.
        These are usually the result of misconfigured or absent BGP route filtering or lack of coordination between autonomous systems.
      </t>

      <t>
        The mechanism proposed in <xref target="I-D.ietf-grow-route-leak-detection-mitigation"/> uses large-communities to perform detection and mitigation of route leaks.
        While signaling using communities is easy to implement and deploy quickly, it normally relies on operator-maintained policy configuration, which is vulnerable to misconfiguration <xref target="Streibelt"/>.
        The community signal can also be stripped at the ISP boundaries.
      </t>

      <t>
        This document provides configuration automation using 'BGP Roles', which are negotiated using a new BGP Capability Code in the OPEN message <xref target="RFC5492"/>.
        Either or both BGP speakers MAY require the presence of this capability to establish a BGP session.
      </t>

      <t>
        A new optional, transitive BGP Path Attribute, called Only to Customer (OTC), is specified in <xref target="prevention_attribute"/>.  It prevents networks from creating leaks, and detects leaks created by third parties.
      </t>
      <t>
        In the rest of this document, we use the term "Peer" to refer to "lateral peer" for simplicity.
      </t>
     </section>

    <section anchor="defs" title="Peering Relationships">
      <t>
        Despite the use of terms such as "Customer", "Peer", etc. in this document, these are not necessarily business relationships based on payment agreements.
        These terms are used to represent restrictions on BGP route propagation, sometimes known as the Gao-Rexford model <xref target="Gao"/>.
        The following is a list of various roles in eBGP peering and the corresponding rules for route propagation:
        <list style="hanging">
          <t hangText="Provider:">
            MAY propagate any available route to a Customer.
          </t>
          <t hangText="Customer:">
            MAY propagate any route learned from a Customer, or locally originated, to a Provider.
            All other routes MUST NOT be propagated.
          </t>
          <t hangText="Route Server (RS):">
            MAY propagate any available route to a Route Server Client (RS-Client).
          </t>
          <t hangText="RS-client:">
            MAY propagate any route learned from a Customer, or locally originated, to a Route Server (RS).
            All other routes MUST NOT be propagated.
          </t>
          <t hangText="Peer:">
            MAY propagate any route learned from a Customer, or locally originated, to a Peer.
            All other routes MUST NOT be propagated.
          </t>
        </list>
      </t>
      <t>
        A BGP speaker may apply policy to reduce what is announced, and a recipient may apply policy to reduce the set of routes they accept.
        Violation of the above rules may result in route leaks.
        At the moment of writing the above rules are often implemented with BGP communities, but the BGP community marking and corresponding route filtering configuration processes are not part of BGP protocol itself.
        Automatic enforcement of these rules should significantly reduce route leaks that may otherwise occur due to manual configuration mistakes.
      </t>
    </section>

    <section anchor="bgp_role" title="BGP Role">
      <t>
        BGP Role is a new configuration option that is configured on a per-session basis.
        BGP Roles reflect the agreement between two BGP speakers about their relationship.
        One of the Roles described below SHOULD be configured on each eBGP session between autonomous systems that carry IPv4 and(or) IPv6 unicast prefixes.
      </t>
      <t>
        Allowed Roles for eBGP sessions between ISPs are:
        <list style="symbols">
          <t>Provider - sender is a transit Provider to neighbor;</t>
          <t>Customer - sender is a transit Customer of neighbor;</t>
          <t>RS - sender is a Route Server, usually at an Internet exchange point (IX);</t>
          <t>RS-client - sender is client of an RS;</t>
          <t>Peer - sender and neighbor are Peers.</t>
        </list>
      </t>
      <section anchor="capability" title="BGP Role Capability">
        <t>
          The BGP Role Capability is defined as follows:
          <list style="symbols">
            <t>Code - 9;</t>
            <t>Length - 1 (byte);</t>
            <t>Value - integer corresponding to speaker's BGP Role (see <xref target="values"/>).</t>
          </list>
        </t>
        <texttable anchor="values" title="Predefined BGP Role Values" suppress-title="false">
          <ttcol align="center">Value</ttcol>
          <ttcol align="left">Role name</ttcol>
          <c>0</c>
          <c>Sender is Provider</c>
          <c>1</c>
          <c>Sender is RS</c>
          <c>2</c>
          <c>Sender is RS-client</c>
          <c>3</c>
          <c>Sender is Customer</c>
          <c>4</c>
          <c>Sender is Peering Patner</c>
          <c>5-255</c>
          <c>Reserved</c>
        </texttable>
        <t>
          If a BGP Role is locally configured a speaker MUST announce BGP Role Capability in the BGP OPEN message exchange.
          A BGP Speaker MUST NOT advertise multiple versions of the BGP Role Capability.
        </t>

      </section>
      <section anchor="correctness" title="Role correctness">
        <t>
          <xref target="capability"/> described how BGP Role encodes the relationship between two eBGP speakers.
          But the mere presence of BGP Role doesn't automatically guarantee role agreement between two BGP peers.
        </t>

        <t>
          If the BGP Role Capability is advertised and one is also received from the peer, the roles must correspond to the relationships in Table 2.
          If the roles do not correspond, the BGP Speaker MUST reject the connection using the Role Mismatch Notification (code 2, subcode 8).
        </t>
        <texttable anchor="allowed" title="Allowed Pairs of Role Capabilities" suppress-title="false">
          <ttcol align="left">Local Role</ttcol>
          <ttcol align="left">Remote Role</ttcol>
          <c>Provider</c>
          <c>Customer</c>

          <c>Customer</c>
          <c>Provider</c>

          <c>RS</c>
          <c>RS-client</c>

          <c>RS-client</c>
          <c>RS</c>

          <c>Peer</c>
          <c>Peer</c>
        </texttable>
        <t>
          If a BGP Speaker receives multiple copies of the BGP Role Capability, all corresponding remote roles MUST be checked with the local role.
        </t>
        <t>
          If the BGP Role Capability is sent, but one is not received, then the connection MAY be rejected using the Role Mismatch Notification (code 2, subcode 8); this mode of operation is called "strict mode".
          For backward compatibility, if the BGP speaker does not receive the capability from its peer, it SHOULD treat such a scenario as a successful negotiation and proceed with session establishment; this SHOULD be the default mode of operation.
        </t>
      </section>
    </section>

    <section anchor="prevention_attribute" title="BGP Only to Customer (OTC) Attribute">
      <t>
        The Only to Customer (OTC) Attribute is an optional transitive path attribute with Attribute Type Code 35 and a length of 4 octets.
        The purpose of this attribute is to guarantee that once a route is sent to Customer, Peer, or RS-client, it will subsequently go only to Customers.
        The attribute value is an AS number (ASN) determined by the policy described below.
      </t>

      <t>
        The following ingress policy applies to the OTC attribute:
        <list style="numbers">
          <t>
            If a route with the OTC attribute is received from a Customer or RS-client, then it is a route leak and MUST be considered ineligible.
          </t>
          <t>
            If a route with the OTC attribute is received from a Peer and its value is not equal to the sending neighbor's Autonomous System (AS) number, then it is a route leak and MUST be considered ineligible.
          </t>
          <t>
            If a route is received from a Provider, Peer, or RS and the OTC attribute is not present, then it MUST be added with value equal to the sending neighbor's AS number.
          </t>
        </list>
      </t>

      <t>
        The following egress policy applies to the OTC attribute:
        <list style="numbers">
          <t>
            A route with the OTC attribute set MUST NOT be sent to Providers, Peers, or RS(s).
          </t>
          <t>
            If a route is sent to a Customer or Peer, or an RS-client (when the sender is an RS) and the OTC attribute is not present, then it MUST be added with a value equal to the AS number of the sender.
          </t>
        </list>
      </t>

      <t>
        The described ingress and egress policies are specific only for unicast IPv4 and IPv6 address families only and MUST not affect other address families by default.
        The operator MUST NOT have the ability to modify the policies defined in this section.
      </t>

      <t>
        If a speaker receives the OTC attribute with length different from 4 bytes it SHOULD be stripped.
        Otherwise, once the OTC attribute has been set, it MUST be preserved unchanged.
      </t>
    </section>

    <section anchor="considerations" title="Additional Considerations">
      <t>
        There are peering relationships that are 'complex', i.e., both parties are intentionally advertising prefixes received from each other to their non-transit Peers and/or transit Providers.
        If multiple BGP peerings can segregate the 'complex' parts of the relationship, the complex peering roles can be segregated into different normal BGP sessions, and BGP Roles MUST be used on each of the resulting normal (non-complex) BGP sessions.
      </t>

      <t>
        No Roles SHOULD be configured on a 'complex' BGP session (assuming it is not segregated) and in that case, the OTC attribute processing MUST be done relying on configuration on a per-prefix basis.
        In this case per-prefix OTC configuration MUST follow the same logic of peering relations described in <xref target="prevention_attribute"/>.
        However, there are no built-in measures to check correctness of OTC use if BGP Role is not configured.
      </t>

      <t>
        The incorrect setting of BGP Roles and/or OTC attributes may affect prefix propagation.
        Further, this document doesn't specify any special handling of incorrect/private ASNs in the OTC attribute; such errors should not happen with proper configuration.
      </t>

      <t>
        As BGP Role configuration results in the automatic creation of inbound/outbound filters, the existence of roles should be treated as the existence of Import and Export policy <xref target="RFC8212"/>.
      </t>
    </section>


    <section anchor="IANA" title="IANA Considerations">
      <t>
        This document defines a new Capability Codes option, named "BGP Role".
        IANA has assigned value 9.
        [to be removed upon publication: https://www.iana.org/assignments/capability-codes/capability-codes.xhtml ]
        <xref target="RFC5492"/>
      </t>

      <t>
        The BGP Role capability includes a Value field, for which IANA is requested to create and maintain a new sub-registry called "BGP Role Value" in the Capability Codes registry.
        Assignments consist of Value and corresponding Role name.
        Initially, this registry is to be populated with the data contained in <xref target="values"/> found in <xref target="capability"/>.
        Future assignments may be made by a Standard Action procedure <xref target="RFC8126"/>.
        The allocation policy for new entries up to and including value 127 is "Expert Review" <xref target="RFC8126"/>.
        The allocation policy for values 128 through 251 is "First Come First Served".
        The values from 252 through 255 are for "Experimental Use".
      </t>
      <t>
        This document defines a new subcode, the "Role Mismatch" Message Error subcode.
        IANA has assigned value 8.
        [to be removed upon publication: http://www.iana.org/assignments/bgp-parameters/bgp-parameters.xhtml#bgp-parameters-6]
        <xref target="RFC4271"/>.
      </t>

      <t>
        This document defines the "Only to Customer (OTC)" BGP Path Attribute.
        IANA has assigned code value 35.
        [To be removed upon publication: http://www.iana.org/assignments/bgp-parameters/bgp-parameters.xhtml#bgp-parameters-2]
        <xref target="RFC4271"/>.
      </t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>
        This document proposes a mechanism for the prevention of route leaks that are the result of BGP policy misconfiguration.
      </t>

      <t>
        A role misconfiguration may affect prefix propagation.
        For example, if the downstream link will be configured with Provider or Peer role, this will limit the number of prefixes that can be advertised in this direction.
        On other hand, if the upstream provider will be configured with the Customer role, this may result in propagating routes that are received from other Providers or Peers.
        But the role negotiation process and simplicity compared to community configuration should make such misconfiguration unlikely.
      </t>

      <t>
        Setting strict mode negotiation by default may result in a situation when the BGP session won't come up after a software update.
        Such implementation of this document is strongly discouraged.
      </t>

      <t>
        Removing the OTC attribute or changing its value can limit the opportunity of route leak detection.
        Such activity can be done on purpose as part of the MiTM attack.
        For example, an AS can remove the OTC attribute on a received route and then leak the route to its transit provider.
        Such malicious activity cannot be prevented without cryptographically signing the update <xref target="RFC8205"/> or out of band detection <xref target="I-D.ietf-sidrops-aspa-verification"/>, but such schemes are beyond the scope of this document.
      </t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      &RFC2119;
      &RFC4271;
      &RFC5492;
      &RFC8174;
      &RFC7908;
      &RFC8126;
    </references>

    <references title="Informative References">
      &RFC8212;
      &RFC8205;
      &I-D.ietf-grow-route-leak-detection-mitigation;
      &I-D.ietf-sidrops-aspa-verification;

      <reference anchor="Streibelt" target="https://people.mpi-inf.mpg.de/~fstreibelt/preprint/communities-imc2018.pdf">
        <front>
          <title>BGP Communities: Even more Worms in the Routing Can</title>
          <author initials="F." surname="Streibelt"/>
          <author initials="F." surname="Lichtblau"/>
          <author initials="R." surname="Beverly"/>
          <author initials="A." surname="Feldmann"/>
          <author initials="C." surname="Cristel"/>
          <author initials="G." surname="Smaragdakis"/>
          <author initials="R." surname="Bush"/>
          <date/>
        </front>
      </reference>
      <reference anchor="Gao" target="https://ieeexplore.ieee.org/document/974523">
        <front>
          <title>Stable Internet routing without global coordination</title>

          <author initials="L." surname="Gao">
          </author>
          <author initials="J." surname="Rexford">
          </author>

          <date month='December' year='2001' />
        </front>
        <seriesInfo name='' value='IEEE/ACM Transactions on Networking, Volume 9, Issue 6, pp 689-692, DOI 10.1109/90.974523' />
      </reference>

    </references>

    <section title="Acknowledgements" numbered="no">
      <t>
        The authors wish to thank Andrei Robachevsky, Daniel Ginsburg, Jeff Haas, Ruediger Volk, Pavel Lunin, Gyan Mishra, Ignas Bagdonas, Sue Hares, and John Scudder for comments, suggestions, and critique.
      </t>
    </section>
    <section title="Contributors" numbered="no">
      <figure><artwork><![CDATA[

Brian Dickson
Independent
Email: brian.peter.dickson@gmail.com

Doug Montgomery
USA National Institute of Standards and Technology
Email: dougm@nist.gov

      ]]></artwork></figure>

    </section>
  </back>
</rfc>


