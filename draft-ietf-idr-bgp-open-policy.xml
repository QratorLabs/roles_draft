<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC4271 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4271.xml">
<!ENTITY RFC4486 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4486.xml">
<!ENTITY RFC5226 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5226.xml">
<!ENTITY RFC5492 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5492.xml">
<!ENTITY RFC7908 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7908.xml">
<!ENTITY RFC8174 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY RFC8212 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8212.xml">

<!ENTITY I-D.ietf-idr-route-leak-detection-mitigation SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-ietf-idr-route-leak-detection-mitigation-10.xml">
]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<rfc category="std" docName="draft-ietf-idr-bgp-open-policy-06" ipr="trust200902">
  <front>
    <title abbrev="Route Leak Prevention">Route Leak Prevention using Roles in Update and Open messages</title>
    <author fullname="Alexander Azimov" initials="A"
            surname="Azimov">
      <organization>Qrator Labs</organization>
      <address>
        <email>a.e.azimov@gmail.com</email>
      </address>
    </author>

    <author fullname="Eugene Bogomazov" initials="E"
            surname="Bogomazov">
      <organization>Qrator Labs</organization>
      <address>
        <email>eb@qrator.net</email>
      </address>
    </author>

    <author fullname="Randy Bush" initials="R"
            surname="Bush">
      <organization>Internet Initiative Japan &amp; Arrcus</organization>
      <address>
        <email>randy@psg.com</email>
      </address>
    </author>

    <author fullname="Keyur Patel" initials="K"
            surname="Patel">
      <organization>Arrcus, Inc.</organization>
      <address>
        <email>keyur@arrcus.com</email>
      </address>
    </author>

    <author fullname="Kotikalapudi Sriram" initials="K"
            surname="Sriram">
      <organization>US NIST</organization>
      <address>
        <email>ksriram@nist.gov</email>
      </address>
    </author>

    <date/>

    <keyword>BGP</keyword>
    <keyword>Route leak</keyword>
    <keyword>BGP role</keyword>

    <abstract>
      <t>
        Route Leaks are the propagation of BGP prefixes which violate assumptions of BGP topology relationships; e.g. passing a route learned from one peer to another peer or to a transit provider, passing a route learned from one transit provider to another transit provider or to a peer.
        Today, approaches to leak prevention rely on marking routes by operator configuration, with no check that the configuration corresponds to that of the BGP neighbor, or enforcement that the two BGP speakers agree on the relationship.
        This document enhances BGP OPEN to establish agreement of the (peer, customer, provider, Route Server, Route Server client) relationship of two neighboring BGP speakers to enforce appropriate configuration on both sides.
        Propagated routes are then marked with an OTC attribute according to the agreed relationship, allowing both prevention and detection of route leaks.
      </t>
    </abstract>

    <note title="Requirements Language">
      <t>
	The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
	"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
	"OPTIONAL" in this  document are to be interpreted as described in
	BCP&nbsp;14 <xref target="RFC2119"/> <xref target="RFC8174"/> when,
	and only when, they appear in all capitals, as shown here.
      </t>
    </note>
  </front>

  <middle>

    <section title="Introduction" anchor="intro">
      <t>
        BGP route leaks are BGP route(s) which were learned from transit provider or peer and then announced to another provider or peer. See <xref target="RFC7908"/>.
        These are usually the result of misconfigured or absent BGP route filtering or lack of coordination between two BGP speakers.
      </t>

      <t>
        The mechanism proposed in <xref target="I-D.ietf-idr-route-leak-detection-mitigation"/> uses large-communities to attempt detection of route leaks.
        While signaling using communities is easy to implement, ut relies on operator maintained policy configuration which is too easily, and too often, misconfigured.
        Another problem may occur if the community signal is stripped, accidentally or maliciously.
      </t>

      <t>
        This document provides  configuration automation using 'BGP roles', which are negotiated using a new BGP Capability Code in OPEN message, <xref target="RFC5492"/> Sec 4.
        Either or both BGP speakers MAY be configured to require that this capability be agreed for the BGP OPEN to succeed.
      </t>

      <t>
        A new BGP Path Attribute is specified that SHOULD be automatically configured using BGP roles.
        This attribute prevents networks from creating leaks, and detects leaks created by third-parties.
      </t>
     </section>

    <section anchor="defs" title="Peering Relationships">
      <t>
        Despite uses of words such as "Customer," "Peer." etc.; these are not business relationships, who pays whom, etc.
        These are common terms to represent restrictions on BGP route propagation, sometimes known as the Gao-Rexford model [cite].
        <list style="hanging">
          <t hangText="A Provider:">
            MAY send to a customer all available prefixes.
          </t>
          <t hangText="A Customer:">
            MAY send to a provider their own prefixes and prefixes learned from any of their customers.
            A customer MUST NOT send to a provider prefixes learned from its peers, from other providers, or from Route Servers.
          </t>
          <t hangText="A Route Server (RS)">
            MAY send to a RS Client all available prefixes.
          </t>
          <t hangText="A Route Server Client (RS-client)">
            MAY send to an RS its own prefixes and prefixes learned from its customers.
            A RS-client MUST NOT send to an RS prefixes learned from peers, from its providers, or from other RS(s).
          </t>
          <t hangText="A Peer:">
            MAY send to a peer its own prefixes and prefixes learned from its customers.
            A peer MUST NOT send to a peer prefixes learned from other peers, from its providers, or from RS(s).
          </t>
        </list>
      </t>
      <t>
        Of course, any BGP speaker may apply policy to reduce what is announced, and a recipient may apply policy to reduce the set of routes they accept.
        Violation of the above rules may result in route leaks so MUST not be allowed.
        Automatic enforment of these rules should significantly reduce configuration mistakes.
        While these enforcing the above rules will address most BGP peering scenarios, their configuration isn't part of BGP itself; therefore requiring configuration of ingress and egress prefix filters is still strongly advised.
      </t>
    </section>

    <section anchor="bgp_role" title="BGP Role">
      <t>
        BGP Role is new configuration option that SHOULD be configured on each BGP session.
        It reflects the real-world agreement between two BGP speakers about their relationship.
      </t>
      <t>
        Allowed Role values for eBGP sessions are:
        <list style="symbols">
          <t>Provider - sender is a transit provider to neighbor;</t>
          <t>Customer - sender is transit customer of neighbor;</t>
          <t>RS - sender is a Route Server, usually at internet exchange point (IX)</t>
          <t>RS-Client - sender is client of RS</t>
          <t>Peer - sender and neighbor are peers;</t>
        </list>
      </t>
      <t>
        Since BGP Role reflects the relationship between two BGP speakers, it could also be used for more than route leak mitigation.
      </t>
    </section>

    <section anchor="capability" title="Role capability">
      <t>The TLV (type, length, value) of the BGP Role capability
        are:
        <list style="symbols">
          <t>Type - &lt;TBD1&gt;;</t>
          <t>Length - 1 (octet);</t>
          <t>Value - integer corresponding to speaker' BGP Role.</t>
        </list>
      </t>
      <texttable anchor="values" title="Predefined BGP Role Values" suppress-title="false">
        <ttcol align="center">Value</ttcol>
        <ttcol align="left">Role name</ttcol>
        <c>0</c>
        <c>Sender is Provider</c>
        <c>1</c>
        <c>Sender is RS</c>
        <c>2</c>
        <c>Sender is RS-Client</c>
        <c>3</c>
        <c>Sender is Customer</c>
        <c>4</c>
        <c>Sender is Peer</c>
      </texttable>

    </section>

    <section anchor="correctness" title="Role correctness">
      <t>
        <xref target="bgp_role"/>
        described how BGP Role encodes
        the relationship between two BGP speakers. But the mere presence
        of BGP Role doesn't automatically guarantee role agreement between
        two BGP peers.
      </t>

      <t>
        To enforce correctness, the BGP Role check is used with a set
        of constrains on how speakers' BGP Roles MUST correspond. Of
        course, each speaker MUST announce and accept the BGP Role
        capability in the BGP OPEN message exchange.
      </t>

      <t>
        If a speaker receives a BGP Role capability, it MUST check the
        value of the received capability with its own BGP Role (if it is set).
        The allowed pairings are (first a sender's Role, second the receiver's
        Role):
      </t>
      <texttable anchor="allowed" title="Allowed Role Capabilities" suppress-title="false">
        <ttcol align="left">Sender Role</ttcol>
        <ttcol align="left">Receiver Role</ttcol>
        <c>Provider</c>
        <c>Customer</c>

        <c>Customer</c>
        <c>Provider</c>

        <c>RS</c>
        <c>RS-Client</c>

        <c>RS-Client</c>
        <c>RS</c>

        <c>Peer</c>
        <c>Peer</c>
      </texttable>
      <t>
        If the Role pair is not in the above table, a speaker MUST send a Role Mismatch Notification (code 2, sub-code &lt;TBD2&gt;).
      </t>

      <section title="Strict mode" anchor="strict">
        <t>
          A new BGP configuration option "strict mode" is defined with
          values of true or false. If set to true, then the speaker MUST
          refuse to establish a BGP session with a neighbor which does not announce
          the BGP Role capability in the OPEN message. If a speaker rejects
          a connection, it MUST send a Connection Rejected Notification
          <xref target="RFC4486"/>
          (Notification with error code 6, subcode 5). By
          default, strict mode SHOULD be set to false for backward
          compatibility with BGP speakers that do not yet support this
          mechanism.
        </t>
      </section>
    </section>

    <section anchor="prevention_attribute" title="BGP Only To Customer attribute">
      <t>
        The Only To Customer (OTC) BGP Attribute is a new optional, transitive BGP Path attribute with the Type Code &lt;TBD3&gt;.
      </t>

      <t>
        This four byte attribute MUST apply the following policy:
        <list style="numbers">
          <t>
            If a route with OTC attribute is received from Customer or RS-client - it's a route leak and MUST be rejected.
          </t>
          <t>
            If a route with OTC attribute is received from Peer and its value isn't equal to the neighbor's ASN - it's a route leak and MUST be rejected.
          </t>
          <t>
            If a route is received from a Provider, Peer or RS and the OTC attribute has not been set it MUST be added with value equal to AS number of the neighbor (sender).
          </t>
        </list>
      </t>

      <t>
        The egress policy MUST be:
        <list style="numbers">
          <t>
            A route with the OTC attribute set MUST NOT be sent to providers, peers, or RS(s).
          </t>
          <t>
            If route is sent to customer or peer and the OTC attribute is not set it MUST be added with value equal to AS number of the sender.
          </t>
        </list>
      </t>

      <t>
        Once the OTC attribute has been set, it MUST be preserved unchanged.
      </t>

    </section>

    <section anchor="attrs" title="Enforcement">

      <t>Having the relationship unequivocally agreed between the two
        peers in BGP OPEN is critical; the BGP implementations enforce the relationship
        irrespective of operator policy configuration errors.
      </t>

      <t>Similarly, the application of that
        relationship on prefix propagation using OTC MUST BE enforced by the
        BGP implementations, and not exposed to user mis-configuration. 
      </t>

      <t>As opposed to communities, BGP attributes may not be generally
        modified or filtered by the operator. The router(s) enforce them.
        This is the desired property for the OTC marking. Hence, this
        document specifies OTC as an attribute.
      </t>
    </section>

    <section anchor="considerations" title="Additional Considerations">
      <t>
        As the BGP Role reflects the peering relationship between neighbors, it might have other uses.
        For example, BGP Role might affect route priority, or be used to distinguish borders of a network if a network consists of multiple ASs.
       Though such uses may be worthwhile, they are not the goal of this document. Note that such uses would require local policy control.
      </t>
      <t>
        As BGP role configuration results in automatic creation of inbound/outbound filters, existence of roles should be treated as existence of Import and Export policy. <xref target="RFC8212"/>
      </t>
      <t>
        There are peering relationships which are 'complex'; e.g. when both parties are intentionally sending prefixes received from each other to their peers and/or upstreams.
        If multiple BGP peerings can segregate the 'complex' parts of the relationship, the complex peering roles can be segregated into different BGP sessions, and normal BGP Roles MUST be used on the non-complex sessions.
        No Roles SHOULD be configured on 'complex' BGP sessions, and OTC MUST be set by configuration on a per-prefix basis.
        There can be no measures to check correctness of OTC use if Role is not configured.
      </t>
    </section>


    <section anchor="IANA" title="IANA Considerations">
      <t>This document defines a new Capability Codes option [to be
        removed upon publication:
        http://www.iana.org/assignments/capability-codes/capability-codes.xhtml]
        <xref target="RFC5492"/>, named "BGP Role", assigned value
        &lt;TBD1&gt; . The length of this capability is 1.
      </t>

      <t>The BGP Role capability includes a Value field, for which IANA
        is requested to create and maintain a new sub-registry called "BGP
        Role Value". Assignments consist of Value and corresponding Role
        name. Initially this registry is to be populated with the data in
        <xref target="values"/>. Future assignments may be made by a
        standard action procedure<xref target="RFC5226"/>.
      </t>
      <t>
        This document defines new subcode, "Role Mismatch", assigned
        value &lt;TBD2&gt; in the OPEN Message Error subcodes registry
        [to be removed upon publication:
        http://www.iana.org/assignments/bgp-parameters/bgp-parameters.xhtml#bgp-parameters-6]
        <xref target="RFC4271"/>.
      </t>

      <t>
        This document defines a new optional, transitive BGP Path
        Attributes option, named "Only To Customer", assigned value
        &lt;TBD3&gt; [To be removed upon publication:
        http://www.iana.org/assignments/bgp-parameters/bgp-parameters.xhtml#bgp-parameters-2]
        <xref target="RFC4271"/>. The length of this attribute is 0.
      </t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>This document proposes a mechanism for prevention
        of route leaks that are the result of BGP policy
        mis-configuration.
      </t>
      <t>Deliberate sending of a known conflicting BGP Role could be
        used to sabotage a BGP connection. This is easily detectable.
      </t>
      <t>
        A misconfiguration in OTC setup may affect prefix propagation.
        But the automation that is provided by BGP roles should make such misconfiguration unlikely.
      </t>
    </section>

    <section anchor="Acknowledgments" title="Acknowledgments">
      <t>The authors wish to thank Douglas Montgomery, Brian Dickson, Andrei Robachevsky, and Daniel Ginsburg for their contributions to a variant of this work.
      </t>
    </section>

  </middle>

  <back>
    <references title="Normative References">
      &RFC2119;
      &RFC4271;
      &RFC4486;
      &RFC5492;
      &RFC8174;
    </references>

    <references title="Informative References">
      &RFC5226;
      &RFC7908;
      &RFC8212;
      &I-D.ietf-idr-route-leak-detection-mitigation;
    </references>
  </back>
</rfc>


